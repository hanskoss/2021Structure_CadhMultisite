#!/bin/bash
cat $1.dat | awk -v pat="None" '{if ($8 ~ pat) {if ($9 ~ pat) {print $0} else {printf "%s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s\n", $1, $2, $3, $4, $5, $6, $7, $9, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20}} else {print $0}}' | awk -v pat="None" '{if ($9 ~ pat) {if ($8 ~ pat) {print $0} else {printf "%s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s\n", $1, $2, $3, $4, $5, $6, $7, $8, $8, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20}} else {print $0}}' | awk -v pat="\[" '{if ($8 ~ pat) {if ($9 ~ pat) {print $0} else {printf "%s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s\n", $1, $2, $3, $4, $5, $6, $7, $9, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20}} else {print $0}}' | awk -v pat="\[" '{if ($9 ~ pat) {if ($8 ~ pat) {print $0} else {printf "%s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s %s\n", $1, $2, $3, $4, $5, $6, $7, $8, $8, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20}} else {print $0}}' > peaklist.csv
sed "s/\[\([0-9]*\)\]\t\[\([0-9]*\)\]/\1 \2/g" peaklist.csv | sed "s/\[[0-9]*\]\t\([A-Z]\)\([0-9][0-9]*\)[A-Za-z]*/\1 \2/g" | sed "s/\([A-Z]\)\([0-9][0-9]*\)[A-Za-z]*\t\[[0-9]*\]/\1 \2/g" | sed "s/\([A-Z]\)\([0-9][0-9]*\)[A-Za-z]*\t\([A-Z]\)\([0-9][0-9]*\)[A-Za-z]*/\1 \2/g" | sed "s/\[\([0-9]*\)\]\ \[\([0-9]*\)\]/\1 \2/g" | sed "s/\[[0-9]*\]\ \([A-Z]\)\([0-9][0-9]*\)[A-Za-z]*/\1 \2/g" | sed "s/\([A-Z]\)\([0-9][0-9]*\)[A-Za-z]*\ \[[0-9]*\]/\1 \2/g" | sed "s/\([A-Z]\)\([0-9][0-9]*\)[A-Za-z]*\ \([A-Z]\)\([0-9][0-9]*\)[A-Za-z]*/\1 \2/g" | awk '{printf "%s %s %i %i\n", $8, $9, $10, $11/1000}' > CPMGpeaks.dat
numb=$(($(sed "2,$ ! d" CPMGpeaks.dat | awk '{print $3}' | sort -n | sed "$ ! d")-1))
echo "ref" > ref
cat CPMGpeaks.dat | grep "[A-Z]* [0-9]* ""$((numb+1))"" " | awk -v numb=$numb '{for(c=0;c<numb;c++) printf "%s\n", $4}' >> ref; sed "1 ! d" CPMGpeaks.dat > CPMGnew.dat; for i in $(seq 2 1 $(wc ref | awk '{print $1}')); do grep -v "[A-Z]* [0-9]* ""$((numb+1))"" " CPMGpeaks.dat | sed "$i ! d" | awk -v ref=$(sed "$i ! d" ref) '{printf "%s %s %s %i\n", $1, $2, $3, $4-ref}'; done >> CPMGnew.dat
mv CPMGnew.dat CPMGpeaks.dat

